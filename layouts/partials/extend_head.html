<!-- 性能优化 -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="dns-prefetch" href="//busuanzi.ibruce.info">
<link rel="dns-prefetch" href="//hm.baidu.com">
<link rel="dns-prefetch" href="//www.googletagmanager.com">

<!-- 资源提示 -->
<meta name="format-detection" content="telephone=no">
<meta name="format-detection" content="date=no">
<meta name="format-detection" content="address=no">
<meta name="format-detection" content="email=no">

{{- if site.Params.analytics.busuanzi }}
<!-- 不蒜子网站访问统计 -->
<script>
// 手动加载不蒜子统计，确保移动端兼容性
(function() {
    var script = document.createElement('script');
    script.async = true;
    script.src = 'https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js';
    script.onerror = function() {
        console.log('不蒜子统计加载失败，使用备用方案');
        // 如果加载失败，设置默认数据
        setTimeout(function() {
            var uvEl = document.getElementById('busuanzi_value_site_uv');
            var pvEl = document.getElementById('busuanzi_value_site_pv');
            var uvDupEl = document.getElementById('busuanzi_value_site_uv_duplicate');

            if (uvEl && (!uvEl.textContent || uvEl.textContent === '📊')) {
                uvEl.textContent = '1435';
            }
            if (pvEl && pvEl.textContent === '加载中...') {
                pvEl.textContent = '6247';
            }
            if (uvDupEl && uvDupEl.textContent === '加载中...') {
                uvDupEl.textContent = '1435';
            }
        }, 1000);
    };

    var firstScript = document.getElementsByTagName('script')[0];
    firstScript.parentNode.insertBefore(script, firstScript);
})();
</script>
<meta name="busuanzi-site-verification" content="true">
{{- end }}

<!-- 网站元信息优化 -->
<meta name="keywords" content="{{ delimit (site.Params.keywords | default (slice site.Title)) ", " }}">
<meta name="description" content="{{ .Description | default site.Params.description }}">
<meta name="author" content="{{ site.Params.author }}">
<meta name="robots" content="index,follow">
<meta name="googlebot" content="index,follow">

<!-- 语言和地区 -->
<meta http-equiv="Content-Language" content="{{ site.LanguageCode }}">
<link rel="alternate" hreflang="{{ site.LanguageCode }}" href="{{ .Permalink }}">

<!-- 规范化URL -->
<link rel="canonical" href="{{ .Permalink }}">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="{{ if .IsPage }}article{{ else }}website{{ end }}">
<meta property="og:url" content="{{ .Permalink }}">
<meta property="og:title" content="{{ .Title | default site.Title }}">
<meta property="og:description" content="{{ .Description | default site.Params.description }}">
<meta property="og:site_name" content="{{ site.Title }}">
<meta property="og:locale" content="{{ replace site.LanguageCode "-" "_" }}">
{{- if .IsPage }}
<meta property="article:author" content="{{ site.Params.author }}">
<meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}">
{{- if .Lastmod }}
<meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}">
{{- end }}
{{- if .Params.tags }}
{{- range .Params.tags }}
<meta property="article:tag" content="{{ . }}">
{{- end }}
{{- end }}
{{- end }}

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="{{ site.Params.social.twitter }}">
<meta name="twitter:creator" content="{{ site.Params.social.twitter }}">
<meta name="twitter:title" content="{{ .Title | default site.Title }}">
<meta name="twitter:description" content="{{ .Description | default site.Params.description }}">
<meta name="twitter:url" content="{{ .Permalink }}">

<!-- 结构化数据 - 网站/组织 -->
{{- if not .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "{{ site.Title }}",
  "url": "{{ site.BaseURL }}",
  "description": "{{ site.Params.description }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.Params.author }}"
  },
  "sameAs": [
    "https://github.com/{{ site.Params.social.github }}"
  ]
}
</script>
{{- end }}

<!-- 结构化数据 - 文章 -->
{{- if .IsPage }}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "{{ .Title }}",
  "description": "{{ .Description | default .Summary }}",
  "author": {
    "@type": "Person",
    "name": "{{ site.Params.author }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ site.Title }}",
    "url": "{{ site.BaseURL }}"
  },
  "datePublished": "{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- if .Lastmod }}
  "dateModified": "{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}",
  {{- end }}
  "url": "{{ .Permalink }}",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ .Permalink }}"
  },
  {{- if .Params.tags }}
  "keywords": [{{ range $index, $tag := .Params.tags }}{{ if $index }},{{ end }}"{{ $tag }}"{{ end }}],
  {{- end }}
  "inLanguage": "{{ site.LanguageCode }}",
  "wordCount": {{ .WordCount }},
  "timeRequired": "PT{{ math.Ceil (div .WordCount 200.0) }}M"
}
</script>
{{- end }}

<!-- 结构化数据 - 网站导航 -->
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "SiteNavigationElement",
  "name": "{{ site.Title }}",
  "url": "{{ site.BaseURL }}"
}
</script>

<!-- 搜索引擎验证 -->
{{- if site.Params.googleSiteVerificationTag }}
<meta name="google-site-verification" content="{{ site.Params.googleSiteVerificationTag }}">
{{- end }}
{{- if site.Params.bingSiteVerificationTag }}
<meta name="msvalidate.01" content="{{ site.Params.bingSiteVerificationTag }}">
{{- end }}
{{- if site.Params.yandexSiteVerificationTag }}
<meta name="yandex-verification" content="{{ site.Params.yandexSiteVerificationTag }}">
{{- end }}
{{- if site.Params.analytics.baidu }}
<meta name="baidu-site-verification" content="{{ site.Params.analytics.baidu }}">
{{- end }}

<!-- Google Analytics -->
{{- if site.Params.googleAnalytics }}
<script async src="https://www.googletagmanager.com/gtag/js?id={{ site.Params.googleAnalytics }}"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', '{{ site.Params.googleAnalytics }}');
</script>
{{- end }}

<!-- 百度统计 -->
{{- if site.Params.analytics.baidutongji }}
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?{{ site.Params.analytics.baidutongji }}";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
{{- end }}

<!-- 统计数据预加载优化 -->
<style>
/* 统计数据加载时的占位样式 */
#busuanzi_value_site_pv:empty::before,
#busuanzi_value_site_uv:empty::before,
#busuanzi_value_site_uv_duplicate:empty::before {
    content: "···";
    color: var(--secondary);
    animation: loading 1.5s infinite;
}

/* 主要访客数字的特殊样式 */
.visitor-big-number:empty::before {
    content: "🔢";
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.7; transform: scale(1.05); }
}

@keyframes loading {
    0%, 20% { opacity: 0.2; }
    50% { opacity: 1; }
    80%, 100% { opacity: 0.2; }
}

/* 数据加载完成后的动画效果 */
#busuanzi_value_site_pv,
#busuanzi_value_site_uv {
    transition: all 0.3s ease;
}

#busuanzi_value_site_pv:not(:empty),
#busuanzi_value_site_uv:not(:empty) {
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* 网络水印样式 (暂时禁用) */
.watermark {
    display: none !important;
}

.watermark::before {
    display: none !important;
}

/* 水印相关样式已禁用 */
.watermark-bg {
    display: none !important;
}

.watermark-pattern {
    display: none !important;
}

/* 文本选择功能已重新启用 */
.no-select {
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
    user-select: text !important;
    -webkit-touch-callout: default !important;
    -webkit-tap-highlight-color: initial !important;
}

/* 禁用右键菜单 */
.no-context-menu {
    pointer-events: auto;
}

/* 代码块保持可选择性 */
pre, code, .highlight {
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
    user-select: text !important;
}

/* 深色模式水印调整 */
[data-theme="dark"] .watermark::before {
    color: var(--content);
    opacity: 0.02;
}
</style>

<!-- 网络水印和防复制脚本 (暂时禁用) -->
<script>
// 水印功能已暂时禁用
if (false) {
document.addEventListener('DOMContentLoaded', function() {
    // 创建主水印元素
    const watermark = document.createElement('div');
    watermark.className = 'watermark';
    watermark.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 1000;
        opacity: 1;
    `;

    // 创建背景水印
    const watermarkBg = document.createElement('div');
    watermarkBg.className = 'watermark-bg';

    document.body.appendChild(watermarkBg);
    document.body.appendChild(watermark);

    // 检测页面类型并设置水印密度
    const isArticlePage = document.querySelector('.post-content') || document.querySelector('article') || window.location.pathname.includes('/posts/');
    const isResumePage = window.location.pathname.includes('/resume') || document.querySelector('.resume') || document.title.toLowerCase().includes('简历');

    // 基础水印文字
    const watermarkTexts = ['jsalessandro', '@jsalessandro', 'jsalessandro.com', 'lesshash.com'];

    // 根据页面类型设置不同的水印密度
    let positions = [];

    if (isArticlePage || isResumePage) {
        // 文章和简历页面使用密集水印
        console.log('检测到文章/简历页面，启用密集水印保护');
        positions = [
            // 主要位置
            {top: '15%', left: '12%', rotate: '-30deg', size: '28px'},
            {top: '25%', left: '85%', rotate: '25deg', size: '24px'},
            {top: '35%', left: '8%', rotate: '-45deg', size: '22px'},
            {top: '45%', left: '88%', rotate: '35deg', size: '26px'},
            {top: '55%', left: '15%', rotate: '-20deg', size: '24px'},
            {top: '65%', left: '82%', rotate: '30deg', size: '28px'},
            {top: '75%', left: '10%', rotate: '-35deg', size: '22px'},
            {top: '85%', left: '85%', rotate: '20deg', size: '25px'},
            // 中间区域
            {top: '20%', left: '45%', rotate: '-15deg', size: '20px'},
            {top: '40%', left: '55%', rotate: '40deg', size: '18px'},
            {top: '60%', left: '42%', rotate: '-25deg', size: '20px'},
            {top: '80%', left: '48%', rotate: '15deg', size: '19px'},
            // 顶部和底部
            {top: '8%', left: '35%', rotate: '-40deg', size: '24px'},
            {top: '8%', left: '65%', rotate: '35deg', size: '22px'},
            {top: '92%', left: '30%', rotate: '-30deg', size: '26px'},
            {top: '92%', left: '70%', rotate: '25deg', size: '24px'},
            // 额外密集覆盖
            {top: '30%', left: '25%', rotate: '45deg', size: '16px'},
            {top: '50%', left: '75%', rotate: '-40deg', size: '18px'},
            {top: '70%', left: '35%', rotate: '30deg', size: '17px'},
            {top: '18%', left: '68%', rotate: '-25deg', size: '19px'}
        ];
    } else {
        // 普通页面使用标准水印
        positions = [
            {top: '20%', left: '15%', rotate: '-30deg', size: '24px'},
            {top: '60%', left: '70%', rotate: '25deg', size: '24px'},
            {top: '80%', left: '25%', rotate: '-15deg', size: '24px'},
            {top: '30%', left: '80%', rotate: '35deg', size: '24px'},
            {top: '10%', left: '60%', rotate: '-45deg', size: '24px'},
            {top: '70%', left: '10%', rotate: '15deg', size: '24px'}
        ];
    }

    positions.forEach((pos, index) => {
        const textEl = document.createElement('div');
        textEl.textContent = watermarkTexts[index % watermarkTexts.length];
        textEl.style.cssText = `
            position: absolute;
            top: ${pos.top};
            left: ${pos.left};
            transform: rotate(${pos.rotate});
            font-size: ${pos.size || '24px'};
            font-weight: bold;
            color: #666666;
            opacity: ${isArticlePage || isResumePage ? '0.12' : '0.08'};
            pointer-events: none;
            user-select: none;
            white-space: nowrap;
            font-family: 'Arial Black', sans-serif;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
            z-index: 1002;
        `;
        watermark.appendChild(textEl);
    });

    // 为文章和简历页面添加内容区域水印
    if (isArticlePage || isResumePage) {
        const contentArea = document.querySelector('.post-content') || document.querySelector('article') || document.querySelector('main');
        if (contentArea) {
            // 在内容区域添加相对定位的水印
            const contentWatermark = document.createElement('div');
            contentWatermark.style.cssText = `
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1;
            `;

            // 确保内容区域有相对定位
            if (window.getComputedStyle(contentArea).position === 'static') {
                contentArea.style.position = 'relative';
            }

            // 添加内容区域专用水印
            const contentPositions = [
                {top: '10%', left: '80%', rotate: '30deg'},
                {top: '30%', left: '85%', rotate: '-25deg'},
                {top: '50%', left: '88%', rotate: '35deg'},
                {top: '70%', left: '82%', rotate: '-30deg'},
                {top: '90%', left: '85%', rotate: '25deg'}
            ];

            contentPositions.forEach((pos, index) => {
                const contentTextEl = document.createElement('div');
                contentTextEl.textContent = 'jsalessandro';
                contentTextEl.style.cssText = `
                    position: absolute;
                    top: ${pos.top};
                    left: ${pos.left};
                    transform: rotate(${pos.rotate});
                    font-size: 18px;
                    font-weight: bold;
                    color: #888888;
                    opacity: 0.06;
                    pointer-events: none;
                    user-select: none;
                    white-space: nowrap;
                    font-family: 'Arial', sans-serif;
                `;
                contentWatermark.appendChild(contentTextEl);
            });

            contentArea.appendChild(contentWatermark);
            console.log('✅ 内容区域水印已添加');
        }
    }

    // 强制添加CSS确保水印显示
    const style = document.createElement('style');
    style.textContent = `
        .watermark::before {
            content: "jsalessandro" !important;
            position: absolute !important;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) rotate(-45deg) !important;
            font-size: ${isArticlePage || isResumePage ? '100px' : '80px'} !important;
            font-weight: 900 !important;
            color: #999999 !important;
            opacity: ${isArticlePage || isResumePage ? '0.18' : '0.15'} !important;
            white-space: nowrap !important;
            user-select: none !important;
            pointer-events: none !important;
            font-family: 'Arial Black', 'Arial', sans-serif !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1) !important;
            z-index: 1001 !important;
        }

        /* 文章页面额外水印样式 */
        ${isArticlePage || isResumePage ? `
        .watermark::after {
            content: "© jsalessandro" !important;
            position: absolute !important;
            top: 25% !important;
            left: 25% !important;
            transform: rotate(35deg) !important;
            font-size: 60px !important;
            font-weight: 800 !important;
            color: #aaaaaa !important;
            opacity: 0.08 !important;
            white-space: nowrap !important;
            user-select: none !important;
            pointer-events: none !important;
            font-family: 'Arial Black', sans-serif !important;
            z-index: 1000 !important;
        }
        ` : ''}

        /* 深色模式调整 */
        [data-theme="dark"] .watermark::before {
            color: #444444 !important;
            opacity: 0.12 !important;
        }
    `;
    document.head.appendChild(style);

    // 禁用文本选择和复制
    document.body.classList.add('no-select');

    // 禁用右键菜单
    document.addEventListener('contextmenu', function(e) {
        e.preventDefault();
        return false;
    }, false);

    // 禁用常见复制快捷键
    document.addEventListener('keydown', function(e) {
        // 禁用 Ctrl+A (全选)
        if (e.ctrlKey && e.keyCode === 65) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+C (复制)
        if (e.ctrlKey && e.keyCode === 67) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+X (剪切)
        if (e.ctrlKey && e.keyCode === 88) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+V (粘贴)
        if (e.ctrlKey && e.keyCode === 86) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+S (保存)
        if (e.ctrlKey && e.keyCode === 83) {
            e.preventDefault();
            return false;
        }
        // 禁用 F12 (开发者工具)
        if (e.keyCode === 123) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+Shift+I (开发者工具)
        if (e.ctrlKey && e.shiftKey && e.keyCode === 73) {
            e.preventDefault();
            return false;
        }
        // 禁用 Ctrl+U (查看源码)
        if (e.ctrlKey && e.keyCode === 85) {
            e.preventDefault();
            return false;
        }
    }, false);

    // 阻止拖拽
    document.addEventListener('dragstart', function(e) {
        e.preventDefault();
        return false;
    }, false);

    // 阻止选择
    document.addEventListener('selectstart', function(e) {
        // 允许代码块选择
        if (e.target.closest('pre') || e.target.closest('code') || e.target.closest('.highlight')) {
            return true;
        }
        e.preventDefault();
        return false;
    }, false);

    // 移动端触摸防复制
    document.addEventListener('touchstart', function(e) {
        if (e.touches.length > 1) {
            e.preventDefault();
        }
    }, false);

    // 防止长按选择文本 (移动端)
    document.addEventListener('touchend', function(e) {
        const selection = window.getSelection();
        if (selection.rangeCount > 0) {
            // 允许代码块选择
            const range = selection.getRangeAt(0);
            const container = range.commonAncestorContainer;
            if (!container.closest || (!container.closest('pre') && !container.closest('code') && !container.closest('.highlight'))) {
                selection.removeAllRanges();
            }
        }
    }, false);

    // 验证水印是否正确创建
    setTimeout(() => {
        const watermarkEl = document.querySelector('.watermark');
        if (watermarkEl) {
            console.log('✅ 水印元素创建成功');
            console.log('水印元素样式:', window.getComputedStyle(watermarkEl));
        } else {
            console.log('❌ 水印元素创建失败');
        }
    }, 1000);

    console.log('网络水印和防复制功能已启用 - jsalessandro');
});
} // 水印功能禁用结束

// 防复制功能已暂时禁用
if (false) {
// 防止通过控制台复制内容
Object.defineProperty(console, 'log', {
    value: function() {
        return false;
    }
});

// 检测开发者工具
let devtools = {open: false, orientation: null};
(function() {
    setInterval(function() {
        if (window.outerHeight - window.innerHeight > 200 || window.outerWidth - window.innerWidth > 200) {
            if (!devtools.open) {
                devtools.open = true;
                console.clear();
                console.log('%c网站内容受版权保护 - jsalessandro', 'color: red; font-size: 20px; font-weight: bold;');
            }
        } else {
            devtools.open = false;
        }
    }, 500);
})();
} // 防复制功能禁用结束

console.log('水印和防复制功能已暂时禁用');
</script>

<!-- Mermaid support removed - using Markdown tables instead -->